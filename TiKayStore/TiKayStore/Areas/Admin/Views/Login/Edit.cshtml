@model TiKayStore.Models.tb_User
@{
    ViewBag.Title = "Chỉnh sửa thông tin nhân viên";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

@section naviheader{
    <!-- Left navbar links -->
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <a href="/admin/home" class="nav-link">Home</a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <a href="#" class="nav-link">Menu</a>
        </li>
    </ul>
}
<style>

    .dropdown-submenu {
        position: relative;
        width: 120px;
        list-style-type:none;
    }

        .dropdown-submenu > .dropdown-menu {
            top: 0;
            left: 100%;
            margin-top: -6px;
            margin-left: -1px;
            -webkit-border-radius: 0 6px 6px 6px;
            -moz-border-radius: 0 6px 6px;
            border-radius: 0 6px 6px 6px;
        }

        .dropdown-submenu:hover > .dropdown-menu {
            display: block;
        }

        .dropdown-submenu > a:after {
            display: block;
            content: " ";
            float: right;
            width: 0;
            height: 0;
            border-color: transparent;
            border-style: solid;
            border-width: 5px 0 5px 5px;
            border-left-color: #ccc;
            margin-top: 5px;
            margin-right: -10px;
        }

        .dropdown-submenu:hover > a:after {
            border-left-color: #fff;
        }

        .dropdown-submenu.pull-left {
            float: none;
        }

            .dropdown-submenu.pull-left > .dropdown-menu {
                left: -100%;
                margin-left: 10px;
                -webkit-border-radius: 6px 0 6px 6px;
                -moz-border-radius: 6px 0 6px 6px;
                border-radius: 6px 0 6px 6px;
            }
</style>

<!-- Content Wrapper. Contains page content -->
<div class="content">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1>Quản lý menu</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Account</li>
                    </ol>
                </div>
            </div>
        </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">

        <!-- Default box -->
        <div class="card-body">
            <div class="card card-primary">
                <div class="card-header">
                    <h3 class="card-title">Thay đổi thông tin nhân viên</h3>
                </div>
                <!-- /.card-header -->
                <!-- form start -->
                @using (Html.BeginForm("Edit", "Login", FormMethod.Post, new { }))
                {
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary(false)

                    <form>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="exampleInputTilte">ID</label>
                                @Html.TextBoxFor(x => x.id, new { @class = "form-control", @placeholder = "Nhập Email" })
                                @Html.ValidationMessageFor(x => x.id, null, new { @class = " text-danger" })
                            </div>
                            <div class="form-group">
                                <label for="exampleInputTilte">Email</label>
                                @Html.TextBoxFor(x => x.email, new { @class = "form-control", @placeholder = "Nhập Email" })
                                @Html.ValidationMessageFor(x => x.email, null, new { @class = " text-danger" })
                            </div>
                            <div class="form-group">
                                <label for="exampleInputTilte">Họ</label>
                                @Html.TextBoxFor(x => x.lastName, new { @class = "form-control", @placeholder = "Nhập Họ" })
                                @Html.ValidationMessageFor(x => x.lastName, null, new { @class = " text-danger" })
                            </div>
                            <div class="form-group">
                                <label for="exampleInputTilte">Tên</label>
                                @Html.TextBoxFor(x => x.firstName, new { @class = "form-control", @placeholder = "Nhập tên" })
                                @Html.ValidationMessageFor(x => x.firstName, null, new { @class = " text-danger" })
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="form3Example3">Quyền nhân viên :</label>
                                <div style=" margin-left: 15px; ">
                                    <li class="dropdown-submenu">
                                        <a class="dropdown-item" tabindex="-1" href="#">Tài khoản</a>
                                        <ul class="dropdown-menu">
                                            @foreach (var names in ViewBag.Retrieval)
                                            {
                                                if (names.Value==1|| names.Value == 2 || names.Value == 3 || names.Value == 4)
                                                {
                                                    var tdId = "td" + names.Value;
                                                    <li class="dropdown-item">
                                                        <table width="100%">
                                                            <tr>
                                                                <td width="20px">
                                                                    <input type="checkbox" id="trow_@names.Value" class="chkclass" value="@names.Value" checked="@names.Selected" />
                                                                </td>
                                                                <td id="@tdId" width="100px">
                                                                    @names.Text
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </li>
                                                }
                                            }

                                        </ul>
                                    </li>

                                    <li class="dropdown-submenu">
                                        <a class="dropdown-item" tabindex="-1" href="#">Sản phẩm</a>
                                        <ul class="dropdown-menu">
                                            @foreach (var names in ViewBag.Retrieval)
                                            {
                                                if (names.Value == 5 || names.Value == 6 || names.Value == 7 || names.Value == 8)
                                                {
                                                    var tdId = "td" + names.Value;
                                                    <li class="dropdown-item">
                                                        <table width="100%">
                                                            <tr>
                                                                <td width="20px">
                                                                    <input type="checkbox" id="trow_@names.Value" class="chkclass" value="@names.Value" checked="@names.Selected" />
                                                                </td>
                                                                <td id="@tdId" width="100px">
                                                                    @names.Text
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </li>
                                                }
                                            }

                                        </ul>
                                    </li>

                                    <li class="dropdown-submenu">
                                        <a class="dropdown-item" tabindex="-1" href="#">Tin tức</a>
                                        <ul class="dropdown-menu">
                                            @foreach (var names in ViewBag.Retrieval)
                                            {
                                                if (names.Value == 12 || names.Value == 13 || names.Value == 14 || names.Value == 15)
                                                {
                                                    var tdId = "td" + names.Value;
                                                    <li class="dropdown-item">
                                                        <table width="100%">
                                                            <tr>
                                                                <td width="20px">
                                                                    <input type="checkbox" id="trow_@names.Value" class="chkclass" value="@names.Value" checked="@names.Selected" />
                                                                </td>
                                                                <td id="@tdId" width="100px">
                                                                    @names.Text
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </li>
                                                }
                                            }

                                        </ul>
                                    </li>

                                    <li class="dropdown-submenu">
                                        <a class="dropdown-item" tabindex="-1" href="#">Danh mục</a>
                                        <ul class="dropdown-menu">
                                            @foreach (var names in ViewBag.Retrieval)
                                            {
                                                if (names.Value == 9 || names.Value == 10 || names.Value == 11 )
                                                {
                                                    var tdId = "td" + names.Value;
                                                    <li class="dropdown-item">
                                                        <table width="100%">
                                                            <tr>
                                                                <td width="20px">
                                                                    <input type="checkbox" id="trow_@names.Value" class="chkclass" value="@names.Value" checked="@names.Selected" />
                                                                </td>
                                                                <td id="@tdId" width="100px">
                                                                    @names.Text
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </li>
                                                }
                                            }

                                        </ul>
                                    </li>

                                    <li class="dropdown-submenu">
                                        <a class="dropdown-item" tabindex="-1" href="#">Menu</a>
                                        <ul class="dropdown-menu">
                                            @foreach (var names in ViewBag.Retrieval)
                                            {
                                                if (names.Value == 16 || names.Value == 17 || names.Value == 18 )
                                                {
                                                    var tdId = "td" + names.Value;
                                                    <li class="dropdown-item">
                                                        <table width="100%">
                                                            <tr>
                                                                <td width="20px">
                                                                    <input type="checkbox" id="trow_@names.Value" class="chkclass" value="@names.Value" checked="@names.Selected" />
                                                                </td>
                                                                <td id="@tdId" width="100px">
                                                                    @names.Text
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </li>
                                                }
                                            }

                                        </ul>
                                    </li>

                                    <li class="dropdown-submenu">
                                        <a class="dropdown-item" tabindex="-1" href="#">Slide</a>
                                        <ul class="dropdown-menu">
                                            @foreach (var names in ViewBag.Retrieval)
                                            {
                                                if (names.Value == 19 || names.Value == 20 || names.Value == 22)
                                                {
                                                    var tdId = "td" + names.Value;
                                                    <li class="dropdown-item">
                                                        <table width="100%">
                                                            <tr>
                                                                <td width="20px">
                                                                    <input type="checkbox" id="trow_@names.Value" class="chkclass" value="@names.Value" checked="@names.Selected" />
                                                                </td>
                                                                <td id="@tdId" width="100px">
                                                                    @names.Text
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </li>
                                                }
                                            }

                                        </ul>
                                    </li>
                                </div>
                            </div>
                            <!-- /.card-body -->

                            <div class="card-footer">
                                <a href="/Admin/Login/ListUser" class="btn btn-danger"> Quay lại</a>
                                <a href="#" class="btn btn-success" id="BtnDeleteAll">Cập nhật</a>
                            </div>
                        </div>
                    </form>
                }

            </div>
        </div>
    </section>
</div>
@section scripts{
    <script>
        $(document).ready(function () {
            $('body').on('click', '#BtnDeleteAll', function (e) {
                e.preventDefault();
                var str = "";
                var checkbox = $(this).parents('.card').find('tr td input:checkbox');
                var i = 0;
                var email = $('#email').val();
                var id = $('#id').val();
                var lastName = $('#lastName').val();
                var firstName = $('#firstName').val();
                checkbox.each(function () {
                    if (this.checked) {
                        var _id = $(this).val();
                        if (i === 0) {
                            str += _id;
                        } else {
                            str += "," + _id;
                        }
                        i++;
                    } else {
                        checkbox.attr('selected', '');
                    }
                });
                if (str.length > 0) {
                    var conf = confirm('Bạn có muốn xóa các bản ghi này hay không?' + str );
                    if (conf === true) {
                        $.ajax({
                            url: '/admin/Login/Edit',
                            type: 'POST',
                            data: { ids: str, idUser: id, Email: email, lastName: lastName, firstName: firstName },
                            success: function (rs) {
                                if (rs.success) {
                                    var url = '@Url.Action("ListUser", "Login")';
                                        window.location.href = url;
                                }
                            }
                        });
                    }
                }
                if (str.length == 0) {
                    var conf = confirm('Bạn có muốn xóa các bản ghi này hay không?'  );
                    if (conf === true) {
                        $.ajax({
                            url: '/admin/Login/Edit',
                            type: 'POST',
                            data: { ids: str, idUser: id, Email: email, lastName: lastName, firstName: firstName },
                            success: function (rs) {
                                if (rs.success) {
                                    var url = '@Url.Action("ListUser", "Login")';
                                        window.location.href = url;
                                }
                            }
                        });
                    }
                }
            });
        });
    </script>
}
